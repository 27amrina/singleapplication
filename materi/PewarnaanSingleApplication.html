<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Apersepsi • Single Application</title>

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root {
            --navbar-h: 55px;
            --footer-h: 40px;
            --brand: #ff3f8e;
            --sidebar-w: 255px;
            --sidebar-gap: 8px;
            --line: #e5e7eb;
        }

        html,
        body {
            height: 100%;
        }

        body {
            padding-bottom: var(--footer-h);
            background: #fff;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        .main-pad {
            padding-top: var(--navbar-h);
        }

        main.app-shell {
            min-height: calc(100vh - var(--navbar-h) - var(--footer-h));
        }

        .navbar,
        .footer {
            background: #fff;
        }

        .footer {
            border-top: 1px solid #eee;
        }

        .menu-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, .04);
        }

        .menu-title {
            padding: .75rem 1rem;
            border-bottom: 1px solid #eee;
            font-weight: 600;
        }

        .menu-item {
            display: block;
            padding: .6rem 1rem;
            color: inherit;
            text-decoration: none;
            font-size: .95rem;
        }

        .menu-item:hover {
            background: #fafafa;
        }

        .menu-item.active {
            background: #f5f5f5;
            font-weight: 600;
        }

        .no-top-gap>aside,
        .no-top-gap>section {
            padding-top: 0 !important;
        }

        .btn-brand {
            background: var(--brand);
            color: #fff;
        }

        .btn-brand:hover {
            color: #fff;
            filter: brightness(.95);
        }

        .materi-card .card-header {
            background: #fff;
            border-bottom: 1px solid #eee;
            padding: .5rem 1rem;
        }

        .page-nav {
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        .page-nav-inner {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: .5rem;
            flex-wrap: wrap;
        }

        /* Mobile: sidebar ikut alur */
        @media (max-width: 767.98px) {
            .sidebar-fixed {
                position: static;
                width: 100%;
            }
        }

        /* Desktop: sidebar fixed kiri, konten bergeser & card dipendekkan */
        @media (min-width: 768px) {
            .sidebar-fixed {
                position: fixed;
                top: var(--navbar-h);
                left: 0;
                width: var(--sidebar-w);
                height: calc(100dvh - var(--navbar-h));
                overflow-y: auto;
            }

            .content-with-fixed {
                margin-left: calc(var(--sidebar-w) + var(--sidebar-gap));
            }

            .materi-card {
                display: flex;
                flex-direction: column;
                max-height: calc(100dvh - var(--navbar-h) - var(--footer-h) - 90px);
            }

            .materi-card .card-body {
                flex: 1 1 auto;
                min-height: 0;
                overflow: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        .flashcard {
            border: 1px solid var(--line);
            border-radius: 8px;
            padding: .75rem;
            cursor: pointer;
            background: #fff;
            transition: background .15s, box-shadow .15s;
        }

        .flashcard.active {
            background: rgba(255, 63, 142, 0.04);
            box-shadow: 0 0 0 1px rgba(255, 63, 142, 0.25);
        }

        .box {
            fill: #fff;
            stroke: #e5e7eb;
            stroke-width: 2;
            rx: 16;
        }

        .line {
            stroke: var(--brand);
            stroke-width: 3;
        }

        .text {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            font-size: 18px;
        }

        .sticky-top-shadow {
            box-shadow: 0 6px 12px rgba(0, 0, 0, .06);
        }

        .dropzone {
            min-height: 60px;
            border: 2px dashed #cbd5e1;
            border-radius: .75rem;
            padding: .5rem;
            background: #fff;
        }

        .dropzone.active {
            border-color: var(--brand);
            background: #ffe6f3;
            /* pink lembut */
        }

        .dropzone.correct {
            border-color: #198754;
            background: #e8fff1;
        }

        .dropzone.wrong {
            border-color: #dc3545;
            background: #fff1f2;
        }

        /* ====== PINK STYLE UNTUK SEMUA PRIMARY ====== */

        /* Badge / chip yang pakai text-bg-primary */
        .text-bg-primary,
        .badge.text-bg-primary {
            background-color: var(--brand) !important;
            color: #fff !important;
        }

        /* Tombol outline-primary jadi pink */
        .btn-outline-primary {
            color: var(--brand);
            border-color: var(--brand);
        }

        .btn-outline-primary:hover,
        .btn-outline-primary:focus {
            background-color: var(--brand);
            border-color: var(--brand);
            color: #fff;
        }

        /* Progress bar default (bg-primary) jadi pink */
        .progress-bar {
            background-color: var(--brand);
        }
    </style>
</head>

<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-light navbar-expand-lg fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="../index.html">
                <i class="bi bi-brush" style="font-size:1.25rem; color:var(--brand)"></i>
                <strong>Pewarnaan Rambut</strong> <span class="fw-normal">• Single Application</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navs">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navs">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="../index.html">Beranda</a></li>
                    <li class="nav-item"><a class="nav-link active fw-semibold" style="color:var(--brand)"
                            aria-current="page" href="videopengantar.html">Materi</a></li>
                    <li class="nav-item"><a class="nav-link" href="../evaluasi.html">Latihan</a></li>
                    <li class="nav-item"><a class="nav-link" href="../kd.html">Tujuan Pembelajaran</a></li>
                    <li class="nav-item"><a class="nav-link" href="../peta.html">Peta Konsep</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- MAIN: sidebar + konten -->
    <main class="main-pad app-shell">
        <div class="container-fluid">
            <div class="row g-1 no-top-gap">
                <!-- SIDEBAR -->
                <aside class="col-12 col-md-auto order-1 order-md-0 p-0">
                    <nav class="menu-card sidebar-fixed shadow-sm">
                        <div class="menu-title"><i class="bi bi-journal-bookmark"></i> Single Application</div>
                        <a class="menu-item" aria-current="page" href="videopengantar.html">
                            <i class="bi bi-lightbulb">Video Pengantar</i>
                        </a>
                        <a class="menu-item " aria-current="page" href="SingleApplication.html">
                            <i class="bi bi-lightbulb"></i> Overview Single Application
                        </a>

                        <!-- A. Pewarnaan Rambut Single -->
                        <div class="active"> <button
                                class="d-flex align-items-center w-100 border-0 bg-transparent menu-item" type="button"
                                data-bs-toggle="collapse" data-bs-target="#submenu-A" aria-expanded="true"
                                aria-controls="submenu-A">
                                <span class="me-2"><i class="bi bi-droplet-half"></i></span>
                                <span class="flex-grow-1 text-start">A. Pewarnaan Rambut Single</span>
                                <i class="bi bi-chevron-down small"></i>
                            </button>
                        </div>
                        <div class="collapse show" id="submenu-A">
                            <ul class="nav flex-column ps-4 my-1">
                                <li><a class="menu-item py-1 active" href="PewarnaanSingleApplication.html">1. Pewarnaan
                                        Single
                                        Application</a></li>
                                <li><a class="menu-item py-1" href="CaraMemilihWarna.html">2. Cara Memilih Warna</a>
                                </li>
                                <li><a class="menu-item py-1" href="MemilihWarnaCat.html">3. Memilih Warna Cat</a>
                                </li>
                                <li><a class="menu-item py-1" href="KontraindikasiPewarnaan.html">4. Kontraindikasi
                                        Pewarnaan</a></li>
                                <li><a class="menu-item py-1" href="HalYangDiperhatikan.html">5. Hal
                                        Diperhatikan</a>
                                </li>
                                <li><a class="menu-item py-1" href="AyoLakukanA.html">6. Ayo Lakukan</a></li>
                            </ul>
                        </div>

                        <!-- B. Toning -->
                        <button class="d-flex align-items-center w-100 border-0 bg-transparent menu-item" type="button"
                            data-bs-toggle="collapse" data-bs-target="#submenu-B" aria-expanded="true"
                            aria-controls="submenu-B">
                            <span class="me-2"><i class="bi bi-palette"></i></span>
                            <span class="flex-grow-1 text-start">B. Toning</span>
                            <i class="bi bi-chevron-down small"></i>
                        </button>
                        <div class="collapse show" id="submenu-B">
                            <ul class="nav flex-column ps-4 my-1">
                                <li><a class="menu-item py-1" href="HairToning.html">1. Hair Toning</a></li>
                                <li><a class="menu-item py-1" href="CiriHairToning.html">2. Ciri Hair Toning</a>
                                </li>
                                <li><a class="menu-item py-1" href="KeunggulanHairToning.html">3. Keunggulan Hair
                                        Toning</a></li>
                                <li><a class="menu-item py-1" href="KosmetikHairToning.html">4. Kosmetik Hair
                                        Toning</a>
                                </li>
                                <li><a class="menu-item py-1" href="ProsedurToning.html">5. Prosedur Melakukan
                                        Toning</a></li>
                                <li><a class="menu-item py-1" href="HalDiperhatikanToning.html">6. Hal
                                        Diperhatikan</a>
                                </li>
                                <li><a class="menu-item py-1" href="AyoLakukanB.html">7. Ayo Lakukan</a></li>
                            </ul>
                        </div>

                        <!-- C. Pewarnaan Uban -->
                        <button class="d-flex align-items-center w-100 border-0 bg-transparent menu-item" type="button"
                            data-bs-toggle="collapse" data-bs-target="#submenu-C" aria-expanded="true"
                            aria-controls="submenu-C">
                            <span class="me-2"><i class="bi bi-person-lines-fill"></i></span>
                            <span class="flex-grow-1 text-start">C. Pewarnaan Uban</span>
                            <i class="bi bi-chevron-down small"></i>
                        </button>
                        <div class="collapse show" id="submenu-C">
                            <ul class="nav flex-column ps-4 my-1">
                                <li><a class="menu-item py-1" href="PewarnaanUban.html">1. Pewarnaan Uban</a></li>
                                <li><a class="menu-item py-1" href="JenisPewarnaanUban.html">2. Jenis Pewarnaan</a>
                                </li>
                                <li><a class="menu-item py-1" href="TeknikPewarnaanUban.html">3. Teknik
                                        Pewarnaan</a>
                                </li>
                                <li><a class="menu-item py-1" href="UjiTempel.html">4. Uji Tempel</a></li>
                                <li><a class="menu-item py-1" href="ProsedurKerjaUban.html">5. Prosedur Kerja</a>
                                </li>
                                <li><a class="menu-item py-1" href="ReaksiAlergiUban.html">6. Reaksi Alergi</a></li>
                                <li><a class="menu-item py-1" href="KesalahanPewarnaanUban.html">7. Kesalahan
                                        Pewarnaan</a></li>
                                <li><a class="menu-item py-1" href="AyoLakukanC.html">8. Ayo Lakukan</a></li>
                            </ul>
                        </div>

                        <!-- Evaluasi -->
                        <a class="menu-item" href="../evaluasi.html">
                            <i class="bi bi-clipboard-check"></i> Evaluasi
                        </a>
                        <a class="menu-item" href="VideoPentup.html">
                            <i class="bi bi-camera-video"></i> Evaluasi
                        </a>
                    </nav>
                </aside>

                <!-- KONTEN KANAN -->
                <section class="col-12 col-md-9 col-xl-10 content-with-fixed order-2 order-md-0">
                    <div class="card shadow-sm materi-card">
                        <div class="card-header d-flex align-items-center gap-2">
                            <i class="bi bi-lightbulb" style="color:var(--brand); font-size:1.25rem;"></i>
                            <h3 class="h5 mb-0 fw-bold">Teknik Pewarnaan Rambut Aplikasi Tunggal (Single Application)
                            </h3>
                        </div>

                        <div class="card-body" id="apersepsi-hair-coloring">
                            <!-- 1. PENJELASAN UMUM + INTERAKTIF -->
                            <section id="umum" class="mb-4">
                                <div class="card shadow-sm border-0">
                                    <div class="card-body">
                                        <h2 class="h5 mb-3">1. Konsep Pewarnaan Rambut Teknik Single Application</h2>

                                        <p>
                                            Pewarnaan <em>single application</em> adalah teknik pewarnaan rambut tunggal
                                            yang dilakukan dengan
                                            menambahkan warna atau <em>hair tinting</em>. Dalam teknik ini, pewarnaan
                                            dilakukan pada seluruh batang
                                            rambut tanpa menggunakan proses bleaching terpisah. Teknik ini dapat
                                            menghasilkan warna baru tanpa
                                            melalui proses bleaching, sehingga memudahkan layanan pewarnaan.
                                        </p>
                                        <p>
                                            Jenis pewarnaan <em>single application</em> melibatkan penambahan warna
                                            tunggal pada seluruh batang rambut
                                            tanpa proses bleaching sebelumnya.
                                        </p>

                                        <!-- Interaktif 1 -->
                                        <div class="mt-3 pt-3 border-top">
                                            <h3 class="h6 mb-2">Latihan Konsep 1 – Definisi Single Application</h3>
                                            <p class="text-secondary small">
                                                Pilih jawaban yang paling tepat sesuai penjelasan di atas.
                                            </p>

                                            <div id="quizDef" class="list-group" data-correct="1">
                                                <label class="list-group-item">
                                                    <input type="radio" name="qDef" class="form-check-input me-2">
                                                    Teknik pewarnaan dengan dua tahap: bleaching lalu pewarnaan.
                                                </label>
                                                <label class="list-group-item">
                                                    <input type="radio" name="qDef" class="form-check-input me-2">
                                                    Teknik pewarnaan tunggal yang menambahkan warna langsung pada rambut
                                                    tanpa bleaching terpisah.
                                                </label>
                                                <label class="list-group-item">
                                                    <input type="radio" name="qDef" class="form-check-input me-2">
                                                    Teknik pemotongan rambut sebelum pewarnaan.
                                                </label>
                                            </div>

                                            <button class="btn btn-outline-primary btn-sm mt-2"
                                                onclick="cekDefinisi()">Cek Jawaban</button>
                                            <button class="btn btn-outline-secondary btn-sm mt-2 ms-2"
                                                onclick="resetDefinisi()">Reset</button>
                                            <div id="feedDefinisi" class="mt-2"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- 2. PERMANEN & TONING + INTERAKTIF -->
                            <section id="jenis" class="mb-4">
                                <div class="card shadow-sm border-0">
                                    <div class="card-body">
                                        <h2 class="h5 mb-3">2. Jenis Single Application: Permanen dan Toning</h2>

                                        <h6 class="mt-1">a. Permanen</h6>
                                        <p>
                                            Teknik ini menggunakan amonia dan hidrogen peroksida untuk mengubah warna
                                            rambut secara keseluruhan.
                                            Hasil warna dapat bertahan hingga sekitar enam bulan sebelum warna luntur
                                            atau rambut baru tumbuh.
                                            Pewarnaan rambut uban termasuk dalam pewarnaan rambut secara permanen.
                                        </p>

                                        <h6 class="mt-2">b. Toning</h6>
                                        <p>
                                            Pewarnaan ini menciptakan efek kontras warna antara bagian tertentu dengan
                                            warna keseluruhan.
                                            Pada toning tidak memerlukan bleaching, karena hanya penambahan pigmen
                                            warna. Toning cocok
                                            untuk menciptakan nuansa baru tanpa perubahan yang terlalu mencolok pada
                                            warna rambut.
                                        </p>

                                        <!-- Interaktif 2 -->
                                        <div class="mt-3 pt-3 border-top">
                                            <h3 class="h6 mb-2">Latihan Konsep 2 – Bedakan Permanen dan Toning</h3>
                                            <p class="text-secondary small">Tentukan apakah pernyataan berikut termasuk
                                                <strong>permanen</strong> atau <strong>toning</strong>.
                                            </p>

                                            <div class="mb-2">
                                                <p class="mb-1">1) Menggunakan amonia dan hidrogen peroksida, mengubah
                                                    warna seluruh rambut dan menutup uban.</p>
                                                <select id="j1" class="form-select form-select-sm w-auto">
                                                    <option value="">-- pilih --</option>
                                                    <option value="permanen">Permanen</option>
                                                    <option value="toning">Toning</option>
                                                </select>
                                            </div>

                                            <div class="mb-2">
                                                <p class="mb-1">2) Memberi efek kontras di beberapa bagian tanpa
                                                    mengubah warna dasar secara menyeluruh.</p>
                                                <select id="j2" class="form-select form-select-sm w-auto">
                                                    <option value="">-- pilih --</option>
                                                    <option value="permanen">Permanen</option>
                                                    <option value="toning">Toning</option>
                                                </select>
                                            </div>

                                            <div class="mb-2">
                                                <p class="mb-1">3) Tidak memerlukan bleaching, hanya menambahkan pigmen
                                                    warna untuk nuansa halus.</p>
                                                <select id="j3" class="form-select form-select-sm w-auto">
                                                    <option value="">-- pilih --</option>
                                                    <option value="permanen">Permanen</option>
                                                    <option value="toning">Toning</option>
                                                </select>
                                            </div>

                                            <button class="btn btn-outline-primary btn-sm mt-2" onclick="cekJenis()">Cek
                                                Jawaban</button>
                                            <button class="btn btn-outline-secondary btn-sm mt-2 ms-2"
                                                onclick="resetJenis()">Reset</button>
                                            <div id="feedJenis" class="mt-2"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- 3. TABEL 6.1 + INTERAKTIF -->
                            <section id="tabel" class="mb-5">
                                <div class="card shadow-sm border-0">
                                    <div class="card-body">
                                        <h2 class="h5 mb-3">Tabel 6.1 Perbedaan Single dan Double Application</h2>

                                        <div class="table-responsive mb-3">
                                            <table class="table table-sm align-middle">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width:50%">Single Application</th>
                                                        <th style="width:50%">Double Application</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            Pewarnaan ini melibatkan proses pewarnaan rambut tunggal
                                                            tanpa bleaching sebelumnya.
                                                            Warna diaplikasikan pada seluruh batang rambut dan
                                                            menghasilkan warna yang lebih dekat
                                                            dengan warna asli rambut.
                                                        </td>
                                                        <td>
                                                            Pewarnaan ini melibatkan dua tahap. Pertama, bleaching untuk
                                                            memudarkan warna asli rambut
                                                            dan kedua, aplikasi pewarnaan untuk mencapai warna yang
                                                            diinginkan.
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="2">
                                                            Perbedaan utamanya terletak pada penggunaan bleaching
                                                            sebelum pewarnaan.
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <!-- Interaktif 3 -->
                                        <div class="mt-3 pt-3 border-top">
                                            <h3 class="h6 mb-2">Latihan Konsep 3 – Single vs Double</h3>
                                            <p class="text-secondary small">Seret pernyataan ke dalam kotak
                                                <strong>Single</strong> atau <strong>Double</strong>.
                                            </p>

                                            <div id="chipPool" class="d-flex flex-wrap gap-2 mb-3">
                                                <span class="badge text-bg-primary p-2 draggable" draggable="true"
                                                    data-key="s1">
                                                    Pewarnaan tunggal tanpa bleaching terpisah.
                                                </span>
                                                <span class="badge text-bg-primary p-2 draggable" draggable="true"
                                                    data-key="s2">
                                                    Warna akhir lebih dekat ke warna asli rambut.
                                                </span>
                                                <span class="badge text-bg-primary p-2 draggable" draggable="true"
                                                    data-key="d1">
                                                    Melibatkan dua tahap: bleaching lalu pewarnaan.
                                                </span>
                                                <span class="badge text-bg-primary p-2 draggable" draggable="true"
                                                    data-key="d2">
                                                    Bleaching digunakan untuk memudarkan warna asli rambut.
                                                </span>
                                            </div>

                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <h6 class="mb-1">Single Application</h6>
                                                    <div class="dropzone" data-accept="single">
                                                        <small class="text-secondary">Letakkan pernyataan yang tepat
                                                            untuk single di sini.</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <h6 class="mb-1">Double Application</h6>
                                                    <div class="dropzone" data-accept="double">
                                                        <small class="text-secondary">Letakkan pernyataan yang tepat
                                                            untuk double di sini.</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="mt-3">
                                                <p class="mb-1">Terakhir, tuliskan dengan kata-katamu sendiri perbedaan
                                                    utamanya:</p>
                                                <textarea id="isiPerbedaan" class="form-control mb-2" rows="3"
                                                    placeholder="Tuliskan perbedaan utamanya ..."></textarea>
                                            </div>

                                            <button class="btn btn-outline-primary btn-sm" onclick="cekTabel()">Cek
                                                Jawaban</button>
                                            <button class="btn btn-outline-secondary btn-sm ms-2"
                                                onclick="resetTabel()">Reset</button>
                                            <div id="feedTabel" class="mt-2"></div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                        </div>
                    </div>

                    <!-- TOMBOL NAVIGASI DI BAWAH KONTEN -->
                    <div class="page-nav">
                        <div class="page-nav-inner">
                            <a class="btn btn-outline-secondary" href="SingleApplication.html">
                                <i class="bi bi-arrow-left"></i> Sebelumnya
                            </a>
                            <a class="btn btn-brand" href="CaraMemilihWarna.html">
                                Berikutnya <i class="bi bi-arrow-right"></i>
                            </a>
                        </div>
                    </div>

                </section>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer fixed-bottom py-2">
        <div class="container d-flex justify-content-between align-items-center small">
            <span>SMKS ISFI BANJARMASIN • Hair Coloring</span>
            <span class="text-muted">© 2025 • Single Application</span>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ==========================
        // PROGRESS (3 blok interaktif)
        // ==========================
        const progress = { def: false, jenis: false, tabel: false };

        function updateProgress() {
            const total = Object.keys(progress).length;
            const done = Object.values(progress).filter(Boolean).length;
            const pct = Math.round((done / total) * 100);
            const bar = document.getElementById("progressBar");
            // Halaman ini belum punya progress bar, jadi cek dulu
            if (!bar) return;
            bar.style.width = pct + "%";
            bar.textContent = pct + "%";
        }

        // ==========================
        // KONSTAN UNTUK DRAG & DROP
        // ==========================
        const mapping = {
            s1: "single",
            s2: "single",
            d1: "double",
            d2: "double",
        };

        const chipPoolEl = document.getElementById("chipPool");
        const chipPoolHTML = chipPoolEl ? chipPoolEl.innerHTML : "";

        // ==========================
        // LOCAL STORAGE
        // ==========================
        const LS_KEY = "singleApplication_interaksi_v1";

        function saveState() {
            if (typeof Storage === "undefined") return;

            const state = {
                progress: { ...progress },
            };

            // --- Latihan 1: Definisi ---
            const quizRoot = document.getElementById("quizDef");
            if (quizRoot) {
                const radios = quizRoot.querySelectorAll('input[type="radio"]');
                let picked = -1;
                radios.forEach((r, i) => {
                    if (r.checked) picked = i;
                });
                state.def = {
                    picked,
                    feedHtml:
                        (document.getElementById("feedDefinisi") || {}).innerHTML || "",
                };
            }

            // --- Latihan 2: Permanen & Toning ---
            const j1El = document.getElementById("j1");
            const j2El = document.getElementById("j2");
            const j3El = document.getElementById("j3");
            state.jenis = {
                j1: j1El ? j1El.value : "",
                j2: j2El ? j2El.value : "",
                j3: j3El ? j3El.value : "",
                feedHtml: (document.getElementById("feedJenis") || {}).innerHTML || "",
            };

            // --- Latihan 3: Drag & drop + teks ---
            const textArea = document.getElementById("isiPerbedaan");
            const zones = {};
            const zoneStatus = {};
            document.querySelectorAll("#tabel .dropzone").forEach((zone) => {
                const name = zone.dataset.accept || "unknown";
                const chips = Array.from(zone.querySelectorAll(".draggable")).map(
                    (chip) => chip.dataset.key
                );
                zones[name] = chips;
                zoneStatus[name] = {
                    correct: zone.classList.contains("correct"),
                    wrong: zone.classList.contains("wrong"),
                };
            });

            state.tabel = {
                text: textArea ? textArea.value : "",
                zones,
                zoneStatus,
                feedHtml: (document.getElementById("feedTabel") || {}).innerHTML || "",
            };

            localStorage.setItem(LS_KEY, JSON.stringify(state));
        }

        function loadState() {
            if (typeof Storage === "undefined") return;
            const raw = localStorage.getItem(LS_KEY);
            if (!raw) return;

            let state;
            try {
                state = JSON.parse(raw);
            } catch (e) {
                console.error("Gagal parse localStorage:", e);
                return;
            }
            if (!state) return;

            // progress
            if (state.progress) {
                progress.def = !!state.progress.def;
                progress.jenis = !!state.progress.jenis;
                progress.tabel = !!state.progress.tabel;
            }

            // --- Latihan 1 ---
            if (state.def) {
                const quizRoot = document.getElementById("quizDef");
                if (quizRoot) {
                    const radios = quizRoot.querySelectorAll('input[type="radio"]');
                    if (
                        typeof state.def.picked === "number" &&
                        state.def.picked >= 0 &&
                        radios[state.def.picked]
                    ) {
                        radios[state.def.picked].checked = true;
                    }
                }
                const feed = document.getElementById("feedDefinisi");
                if (feed && state.def.feedHtml) {
                    feed.innerHTML = state.def.feedHtml;
                }
            }

            // --- Latihan 2 ---
            if (state.jenis) {
                const j1El = document.getElementById("j1");
                const j2El = document.getElementById("j2");
                const j3El = document.getElementById("j3");
                if (j1El) j1El.value = state.jenis.j1 || "";
                if (j2El) j2El.value = state.jenis.j2 || "";
                if (j3El) j3El.value = state.jenis.j3 || "";
                const feed = document.getElementById("feedJenis");
                if (feed && state.jenis.feedHtml) {
                    feed.innerHTML = state.jenis.feedHtml;
                }
            }

            // --- Latihan 3 ---
            if (state.tabel) {
                const textArea = document.getElementById("isiPerbedaan");
                if (textArea) textArea.value = state.tabel.text || "";

                const zonesSaved = state.tabel.zones || {};
                const zoneStatus = state.tabel.zoneStatus || {};

                // reset dropzone & chip pool dulu
                document.querySelectorAll("#tabel .dropzone").forEach((z) => {
                    z.classList.remove("correct", "wrong", "active");
                    z.innerHTML =
                        '<small class="text-secondary">Letakkan pernyataan yang tepat di sini.</small>';
                });

                // kembalikan semua chip ke pool dulu
                if (chipPoolEl && chipPoolHTML) {
                    chipPoolEl.innerHTML = chipPoolHTML;
                }

                // taruh chip ke zona sesuai state
                Object.keys(zonesSaved).forEach((zoneName) => {
                    const zone = document.querySelector(
                        '.dropzone[data-accept="' + zoneName + '"]'
                    );
                    if (!zone) return;
                    const keys = zonesSaved[zoneName] || [];

                    if (keys.length) {
                        const sm = zone.querySelector("small");
                        if (sm) sm.remove();
                    }

                    keys.forEach((key) => {
                        const chip =
                            document.querySelector(
                                '#chipPool .draggable[data-key="' + key + '"]'
                            ) ||
                            document.querySelector(
                                '.dropzone .draggable[data-key="' + key + '"]'
                            );
                        if (chip) zone.appendChild(chip);
                    });

                    const st = zoneStatus[zoneName];
                    if (st) {
                        if (st.correct) zone.classList.add("correct");
                        if (st.wrong) zone.classList.add("wrong");
                    }
                });

                const feed = document.getElementById("feedTabel");
                if (feed && state.tabel.feedHtml) {
                    feed.innerHTML = state.tabel.feedHtml;
                }
            }
        }

        // ==========================
        // INTERAKTIF 1: DEFINISI
        // ==========================
        function cekDefinisi() {
            const root = document.getElementById("quizDef");
            const correctIndex = Number(root.dataset.correct || 0);
            const radios = root.querySelectorAll('input[type="radio"]');
            let picked = -1;
            radios.forEach((r, i) => {
                if (r.checked) picked = i;
            });

            const feed = document.getElementById("feedDefinisi");
            if (picked === -1) {
                feed.innerHTML =
                    '<div class="alert alert-info">Pilih salah satu definisi terlebih dahulu.</div>';
                progress.def = false;
            } else if (picked === correctIndex) {
                feed.innerHTML =
                    '<div class="alert alert-success">✅ Tepat! Single application adalah pewarnaan tunggal tanpa bleaching terpisah.</div>';
                progress.def = true;
            } else {
                feed.innerHTML =
                    '<div class="alert alert-warning">⚠️ Belum tepat. Ingat: single application tidak memakai dua tahap bleaching + pewarnaan.</div>';
                progress.def = false;
            }
            updateProgress();
            saveState();
        }

        function resetDefinisi() {
            if (!confirm("Yakin hapus jawaban Latihan Konsep 1?")) return;
            document
                .querySelectorAll("#quizDef input[type=\"radio\"]")
                .forEach((r) => (r.checked = false));
            const feed = document.getElementById("feedDefinisi");
            if (feed) feed.innerHTML = "";
            progress.def = false;
            updateProgress();
            saveState();
        }

        // ==========================
        // INTERAKTIF 2: PERMANEN & TONING
        // ==========================
        function cekJenis() {
            const j1 = document.getElementById("j1").value;
            const j2 = document.getElementById("j2").value;
            const j3 = document.getElementById("j3").value;

            let benar = 0,
                total = 3;
            if (j1 === "permanen") benar++;
            if (j2 === "toning") benar++;
            if (j3 === "toning") benar++;

            const feed = document.getElementById("feedJenis");
            if (j1 === "" || j2 === "" || j3 === "") {
                feed.innerHTML =
                    '<div class="alert alert-info">Isi dulu semua nomor 1–3.</div>';
                progress.jenis = false;
            } else if (benar === total) {
                feed.innerHTML =
                    '<div class="alert alert-success">✅ Bagus! Kamu sudah bisa membedakan ciri permanen dan toning.</div>';
                progress.jenis = true;
            } else {
                feed.innerHTML =
                    '<div class="alert alert-warning">⚠️ Skor ' +
                    benar +
                    "/" +
                    total +
                    ". Baca lagi bagian permanen dan toning di atas.</div>";
                progress.jenis = false;
            }
            updateProgress();
            saveState();
        }

        function resetJenis() {
            if (!confirm("Yakin hapus jawaban Latihan Konsep 2?")) return;
            ["j1", "j2", "j3"].forEach((id) => {
                const el = document.getElementById(id);
                if (el) el.value = "";
            });
            const feed = document.getElementById("feedJenis");
            if (feed) feed.innerHTML = "";
            progress.jenis = false;
            updateProgress();
            saveState();
        }

        // ==========================
        // INTERAKTIF 3: TABEL + DRAG & TEXT
        // ==========================
        function bindDrag() {
            // draggable chips
            document.querySelectorAll(".draggable").forEach((el) => {
                el.addEventListener("dragstart", (e) => {
                    e.dataTransfer.setData("text/plain", e.target.dataset.key);
                    e.dataTransfer.effectAllowed = "move";
                });
            });

            // dropzones
            document.querySelectorAll("#tabel .dropzone").forEach((zone) => {
                zone.addEventListener("dragover", (e) => {
                    e.preventDefault();
                    zone.classList.add("active");
                });
                zone.addEventListener("dragleave", () => zone.classList.remove("active"));
                zone.addEventListener("drop", (e) => {
                    e.preventDefault();
                    zone.classList.remove("active");
                    const key = e.dataTransfer.getData("text/plain");
                    const chip = document.querySelector(
                        '.draggable[data-key="' + key + '"]'
                    );
                    if (chip) {
                        const sm = zone.querySelector("small");
                        if (sm) sm.remove();
                        zone.appendChild(chip);
                    }
                    saveState();
                });
            });

            // simpan text area saat siswa mengetik
            const txt = document.getElementById("isiPerbedaan");
            if (txt) {
                txt.addEventListener("input", () => {
                    saveState();
                });
            }
        }

        function cekTabel() {
            const zones = document.querySelectorAll("#tabel .dropzone");
            let benarZona = 0;

            zones.forEach((zone) => {
                zone.classList.remove("correct", "wrong");
                const target = zone.dataset.accept;
                const chips = zone.querySelectorAll(".draggable");
                if (chips.length === 0) {
                    zone.classList.add("wrong");
                    return;
                }
                let ok = true;
                chips.forEach((chip) => {
                    if (mapping[chip.dataset.key] !== target) ok = false;
                });
                if (ok) {
                    zone.classList.add("correct");
                    benarZona++;
                } else {
                    zone.classList.add("wrong");
                }
            });

            const txt = (document.getElementById("isiPerbedaan").value || "").toLowerCase();
            const adaBleach = txt.includes("bleach") || txt.includes("bleaching");
            const adaSebelum =
                txt.includes("sebelum") ||
                txt.includes("tahap") ||
                txt.includes("dua") ||
                txt.includes("double");

            const feed = document.getElementById("feedTabel");

            if (benarZona === zones.length && adaBleach && adaSebelum) {
                feed.innerHTML =
                    '<div class="alert alert-success">✅ Keren! Drag & drop dan penjelasan teksmu sudah tepat: double application memakai bleaching sebelum pewarnaan, single tidak.</div>';
                progress.tabel = true;
            } else {
                let pesan = "⚠️ Masih ada yang perlu diperbaiki.";
                if (benarZona !== zones.length)
                    pesan +=
                        " Cek lagi pernyataan mana yang termasuk single atau double.";
                if (!(adaBleach && adaSebelum))
                    pesan +=
                        " Pada teks, sebutkan bahwa perbedaan utama adalah penggunaan bleaching sebelum pewarnaan.";
                feed.innerHTML =
                    '<div class="alert alert-warning">' + pesan + "</div>";
                progress.tabel = false;
            }
            updateProgress();
            saveState();
        }

        function resetTabel() {
            if (!confirm("Yakin hapus jawaban Latihan Konsep 3?")) return;

            document.querySelectorAll("#tabel .dropzone").forEach((z) => {
                z.classList.remove("correct", "wrong", "active");
                z.innerHTML =
                    '<small class="text-secondary">Letakkan pernyataan yang tepat di sini.</small>';
            });

            if (chipPoolEl && chipPoolHTML) {
                chipPoolEl.innerHTML = chipPoolHTML;
            }

            const txt = document.getElementById("isiPerbedaan");
            if (txt) txt.value = "";

            const feed = document.getElementById("feedTabel");
            if (feed) feed.innerHTML = "";

            progress.tabel = false;
            updateProgress();
            saveState();
            bindDrag(); // pasang lagi event drag setelah kita rebuild chipPool
        }

        // ==========================
        // RESET SEMUA
        // ==========================
        function resetAll() {
            if (!confirm("Yakin hapus SEMUA jawaban di semua bagian?")) return;
            resetDefinisi();
            resetJenis();
            resetTabel();
            localStorage.removeItem(LS_KEY);
        }

        // ==========================
        // INIT
        // ==========================
        loadState();    // baca data simpanan
        bindDrag();     // aktifkan drag & drop
        updateProgress(); // update (kalau nanti kamu tambahkan progressBar)
    </script>


</body>

</html>